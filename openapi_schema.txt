openapi: 3.1.0
info:
  title: GammaRips Intelligence API
  version: 1.5.0
  description: >
    API exposing GammaRips "High Gamma" options signals and deep-dive financial research.
    Combines live BigQuery analysis (Winners Dashboard) with static GCS artifacts.
servers:
  - url: https://gammarips-api-469352939749.us-central1.run.app

paths:
  /v1/options-signals/top:
    get:
      operationId: getWinnersDashboard
      summary: Get today's top-ranked options setups
      description: >
        Returns the "Winners Dashboard" â€” a ranked list of high-probability options setups sourced
        live from BigQuery. Filters by trend alignment, volatility favorability, and quality score.
      parameters:
        - name: limit
          in: query
          required: false
          description: Max number of signals to return (default 10).
          schema: { type: integer, default: 10 }
        - name: option_type
          in: query
          required: false
          description: Filter by 'CALL' or 'PUT'.
          schema: { type: string, enum: [CALL, PUT] }
        - name: as_of
          in: query
          required: false
          description: Date (YYYY-MM-DD) or 'latest'.
          schema: { type: string, default: latest }
      responses:
        '200':
          description: Top signals returned.
          content:
            application/json:
              schema: { $ref: '#/components/schemas/SignalList' }

  /v1/options-signals/{ticker}:
    get:
      operationId: getTickerSignals
      summary: Get all active signals for a specific ticker
      description: Retrieves all "High Gamma" setups for a specific stock symbol.
      parameters:
        - name: ticker
          in: path
          required: true
          schema: { type: string }
        - name: as_of
          in: query
          required: false
          schema: { type: string, default: latest }
      responses:
        '200':
          description: Signals found.
          content:
            application/json:
              schema: { $ref: '#/components/schemas/SignalList' }

  /v1:
    get:
      operationId: listDatasets
      summary: List available datasets
      description: Lists top-level folders in the Data Lake (e.g., technicals, recommendations).
      responses:
        '200':
          description: Datasets available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatasetList'

  /v1/{dataset}:
    get:
      operationId: listItems
      summary: List items in a dataset
      description: Lists tickers available in a specific dataset folder.
      parameters:
        - name: dataset
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: List response.
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ItemList' }

  /v1/{dataset}/{id}:
    get:
      operationId: getItem
      summary: Get a specific analysis artifact
      description: Retrieves a deep-dive JSON or Markdown file for a ticker (e.g. detailed technicals).
      parameters:
        - name: dataset
          in: path
          required: true
          schema: { type: string }
        - name: id
          in: path
          required: true
          description: Stock Symbol (e.g. AAPL)
          schema: { type: string }
        - name: as_of
          in: query
          required: false
          schema: { type: string, default: latest }
      responses:
        '200':
          description: Item payload.
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Item' }

components:
  schemas:
    DatasetList:
      type: object
      properties:
        datasets:
          type: array
          items: { type: string }

    ItemList:
      type: object
      properties:
        dataset: { type: string }
        items:
          type: array
          items:
            type: object
            properties:
              id: { type: string }
              href: { type: string }

    SignalList:
      type: object
      properties:
        dataset: { type: string }
        as_of: { type: string }
        items:
          type: array
          items:
            type: object
            properties:
              ticker: { type: string }
              option_type: { type: string }
              strike: { type: number }
              expiration: { type: string }
              setup_quality_signal: { type: string }
              weighted_score: { type: number }
              analysis_summary: { type: string }

    Item:
      type: object
      properties:
        dataset: { type: string }
        id: { type: string }
        as_of: { type: string }
        summary_md: { type: string }
        metrics: { type: object }
        source: { type: string }
        disclaimer: { type: string }

    Error:
      type: object
      required: [error]
      properties:
        error: { type: string }